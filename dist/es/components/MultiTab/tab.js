import{typeof as t,objectSpread2 as i}from"../../_virtual/_rollupPluginBabelHelpers.js";import{SlotsMixin as e}from"../../utils/mixins.js";import{ParentMixin as n}from"../../utils/relation.js";import l from"../Scroll/index.js";import{animate as r}from"../../utils/animate.js";import{getOffset as s}from"../../utils/dom.js";import a from"../../utils/emitter.js";import o from"./nav-title.js";var c={name:"multi-tab",provide:function(){return{multiTab:this}},mixins:[e,a,n("multiTab")],props:{lazyRender:{type:Boolean,default:!0},stickyTop:{type:[Number,Function],default:0},sticky:{type:Boolean,default:!0},initialIndex:{type:Number,default:0},pullUpLoad:{type:[Boolean,Object],default:!1}},data:function(){return{slideOptions:{autoplay:!1,startPageXIndex:0,loop:!1},slideHeight:"",minSlideHeight:0,currentPageIndex:0,initialPageIndex:0,currentScrollTo:0,headerHeight:0,currentScrollTop:0}},computed:{childrenCount:function(){return this.children?this.children.length:0},isSticky:function(){return console.log(this.currentScrollTop<=this.stickyTop,"isSticky"),console.log(Math.abs(this.currentScrollTop)>=this.headerHeight-this.stickyTop,"isSticky"),this.currentScrollTop<=this.stickyTop&&Math.abs(this.currentScrollTop)>0&&Math.abs(this.currentScrollTop)>=this.headerHeight-this.stickyTop},isShowNav:function(){return this.isSticky&&this.sticky}},watch:{currentPageIndex:function(){this.updateHeight()},headerHeight:function(){this.updateHeight()}},methods:{genHeader:function(){var t=this.slots("header");return this.headerVNode=t,t},genNav:function(t){var i=this.$createElement,e=!0;return"sticky"===t&&(e=this.isShowNav),i("div",{class:["multi-tab-nav-wrapper",t,e?"":"hidden"],style:{top:this.stickyTop+"px"}},[this.slots("nav")||this.genDefaultNav(t)])},genDefaultNav:function(){var t=this,i=this.$createElement;return i(l,{ref:"navScroll",refInFor:!0,attrs:{scrollX:!0,scrollY:!1,startX:this.initialIndex}},[i("div",{ref:"navContent",class:"nav-content"},[this.children.map((function(e,n){return i(o,{ref:"navTitle",refInFor:!0,attrs:{title:e.title,index:n},scopedSlots:{default:function(){return e.slots("title")}},nativeOn:{click:function(i){t.handleNavItemClick({item:e,index:n,event:i})}}})}))])])},handleNavItemClick:function(t){var i=t.item,e=t.index,n=t.event;this.$refs.navScroll.forEach((function(t){var i=t.$el.children[0];r({scroller:t,scrollContainer:i,targetEle:n.target})})),this.handleSlideScrollStart(),this.slide.goToPage(e,0),this.$emit("nav-item-click",i,e)},onScroll:function(i){var e=i.y;if(this.headerVNode&&(this.headerHeight=this.headerVNode[0].elm.offsetHeight),this.currentScrollTop=e,console.log(this.isSticky),this.$emit("wrapperScroll",i),this.pullUpLoad){var n=20;if("object"===t(this.pullUpLoad)){var l=this.pullUpLoad.threshold;l>0&&(n=l)}var r=this.children[this.currentPageIndex],s=this.container.scroll,a=s.maxScrollY,o=s.y,c=s.movingDirectionY;Math.abs(o)+n>=Math.abs(a)&&1===c&&!r._isPullingUp&&(r._isPullingUp=!0,this.broadcast("multi-tab-item","pullingUp-".concat(this.currentPageIndex),{index:this.currentPageIndex}))}},handleSlideScrollStart:function(){var t=this,i=this.calculateStickyTop(),e=Math.abs(this.currentScrollTop);this.children.forEach((function(n){if(t.currentPageIndex===n.index&&(n._scrollTop=e),t.isSticky){var l=n._scrollTop;n._marginTop=Math.round(e-Math.max(i,l))}else n._marginTop=0;n.$el.style.marginTop=n._marginTop+"px",n.$el.setAttribute("class","slide-page auto")}))},handleSlideScrollEnd:function(){var t=this;this.updateHeight();var i=this.calculateStickyTop(),e=Math.abs(this.currentScrollTop)-this.children[this.currentPageIndex]._marginTop,n="";this.children.forEach((function(l){if(n="hidden",l.index!==t.currentPageIndex)if(t.isSticky){var r=l._scrollTop;l._marginTop=r?e-l._scrollTop:e-i}else l._marginTop=0;else l._marginTop=0,t.isSticky||(l._scrollTop=0),n="auto";l.$el.style.marginTop=l._marginTop+"px",l.$el.setAttribute("class","slide-page ".concat(n))})),this.isSticky&&this.$nextTick((function(){t.container.scrollTo(0,-Math.max(e,i),0)}))},calculateStickyTop:function(){var t=this.$refs.navScroll[0].$el.offsetHeight+this.stickyTop,i=s(this.slide.$el,this.container.$el).top-t;return Math.round(i)},handleSlideWillChange:function(t){var i=t.pageX;this.nextPageIndex=i},handleSlidePageChanged:function(t){var i=t.pageX;this.currentPageIndex=i},updateHeight:function(){var t=this,i=this.children[this.currentPageIndex].$el,e=i.children[0];e&&(this.slideHeight=e.offsetHeight+20+"px",i._isScroll=parseFloat(this.slideHeight)>parseFloat(this.minSlideHeight),this.$nextTick((function(){t.container.scroll.refresh()})))},initialSlide:function(){var t=this,i=this.$refs,e=i.container,n=i.slide,l=i.navScroll;this.slide=n,this.container=e,this.children.forEach((function(t){t._marginTop=0,t._scrollTop=0,t._isPullingUp=!1,t._isScroll=!0})),l&&l.forEach((function(i){var e=i.$el.children[0].children[t.initialIndex];i.scrollToElement(e,0)}))}},mounted:function(){var t=this;this.$nextTick((function(){t.initialSlide();var i=t.$refs.navScroll[0].$el.offsetHeight+t.stickyTop;t.minSlideHeight=t.container.$el.clientHeight-i+"px"}))},created:function(){var t=this;this.slideOptions.startPageXIndex=this.initialIndex,this.currentPageIndex=this.initialIndex,this.$on("pullingUp",(function(i){var e=i.index,n=i.isPullingUp;t.children[e]._isPullingUp=n}))},render:function(){var t=arguments[0];return console.log(this.isSticky,"isSticky"),t("div",{class:"main-container-wrapper"},[this.genNav("sticky"),t(l,{ref:"container",class:"multi-tab-wrapper",attrs:i({nestedScroll:{groupId:"dummy-divide"}},this.$attrs),on:i({scroll:this.onScroll},this.$listeners)},[t("div",{class:"content-wrapper"},[this.genHeader(),this.genNav(),t(l,{ref:"slide",class:"slide-wrapper",attrs:{bounce:!1,scrollX:!0,scrollY:!1,observeDOM:!1,nestedScroll:{groupId:"dummy-divide"},slide:this.slideOptions},on:{scrollStart:this.handleSlideScrollStart,scrollEnd:this.handleSlideScrollEnd,slideWillChange:this.handleSlideWillChange,slidePageChanged:this.handleSlidePageChanged}},[t("div",{class:"slide-content",style:{height:this.slideHeight,"min-height":this.minSlideHeight}},[this.slots()])])])])])}};export{c as default};
